# Override git urls to use ci-job-token
before_script:
  - git config --global url."https://gitlab-ci-token:${CI_JOB_TOKEN}@gitlab.com/".insteadOf git://gitlab.com
  - git config --global url."https://gitlab-ci-token:${CI_JOB_TOKEN}@gitlab.com/".insteadOf ssh://git@gitlab.com
  - git config --global url."https://dl.cloudsmith.io/${CLOUDSMITH_ENTITLEMENT}/".insteadOf https://dl.cloudsmith.io/basic/
  - echo ""

test:
  stage: test
  tags:
    - docker
  image: lnl7/nix
  script:
    - nix-shell --run make-doc
    - nix-shell --run lint-ci
    - nix-shell --run cape-test-geth
    # - nix-shell --run cape-test-brownie # TODO not working at the moment
  artifacts:
    paths:
      - doc
